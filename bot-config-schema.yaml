# LotaBot Configuration Schema
# This file defines the standard configuration format for all LotaBots

schema_version: "1.0.0"

# Bot Configuration Structure
bot_configuration:
  # Required Fields
  bot:
    name: "string"              # Unique bot identifier
    version: "string"           # Semantic version (e.g., "1.0.0")
    enabled: boolean            # Whether the bot is active
    description: "string"       # Brief description of bot purpose
    category: "string"          # One of: infrastructure, development, operations, data, security
    
  # Trigger Configuration
  triggers:
    - type: "string"            # One of: event, schedule, webhook, manual
      pattern: "string"         # Event pattern or cron expression
      filter: "string"          # Optional filter condition
      priority: "string"        # One of: high, medium, low
      
  # Actions Configuration
  actions:
    - name: "string"            # Action identifier
      type: "string"            # Action type
      command: "string"         # Command or script to execute
      parameters: {}            # Action-specific parameters
      timeout: integer          # Timeout in seconds
      on_success: "string"      # Next action on success
      on_failure: "string"      # Next action on failure
      
  # Constraints and Limits
  constraints:
    max_concurrent_jobs: integer        # Maximum parallel executions
    timeout: integer                    # Default timeout in seconds
    rate_limit:
      requests_per_minute: integer
      burst_size: integer
    retry_policy:
      max_attempts: integer
      backoff: "string"                 # One of: linear, exponential, fixed
      initial_delay: integer            # Initial delay in seconds
      max_delay: integer                # Maximum delay in seconds
    resource_limits:
      cpu: "string"                     # CPU limit (e.g., "1000m")
      memory: "string"                  # Memory limit (e.g., "512Mi")
      
  # Dependencies
  dependencies:
    required:
      - "string"                        # Required bot names
    optional:
      - "string"                        # Optional bot names
    conflicts:
      - "string"                        # Conflicting bot names
      
  # Outputs Configuration
  outputs:
    - type: "string"                    # One of: message, file, metric, log
      destination: "string"             # Output destination
      format: "string"                  # Output format
      retention: integer                # Retention period in days
      
  # Security Configuration
  security:
    permissions:
      - resource: "string"              # Resource identifier
        actions: []                     # Allowed actions
    encryption:
      enabled: boolean
      algorithm: "string"
    authentication:
      method: "string"                  # One of: token, certificate, oauth
      
  # Monitoring Configuration
  monitoring:
    health_check:
      enabled: boolean
      interval: integer                 # Check interval in seconds
      endpoint: "string"                # Health check endpoint
    metrics:
      enabled: boolean
      push_interval: integer            # Metric push interval in seconds
    logging:
      level: "string"                   # One of: debug, info, warn, error
      format: "string"                  # One of: json, text
      
  # Notification Configuration
  notifications:
    - event: "string"                   # Event type to notify on
      channels: []                      # Notification channels
      severity: "string"                # One of: critical, warning, info
      template: "string"                # Message template

# Example: Minimal Configuration
minimal_example:
  bot:
    name: "ExampleBot"
    version: "1.0.0"
    enabled: true
    description: "Example bot configuration"
    category: "development"
  
  triggers:
    - type: "event"
      pattern: "build.completed"
      
  actions:
    - name: "process"
      type: "execute"
      command: "echo 'Processing...'"

# Example: Complete Configuration
complete_example:
  bot:
    name: "TestBot"
    version: "2.1.0"
    enabled: true
    description: "Automated testing bot"
    category: "development"
    
  triggers:
    - type: "event"
      pattern: "build.completed"
      filter: "branch == 'main'"
      priority: "high"
    - type: "schedule"
      pattern: "0 */2 * * *"  # Every 2 hours
      priority: "low"
      
  actions:
    - name: "run_unit_tests"
      type: "execute"
      command: "npm test -- --unit"
      timeout: 600
      on_success: "run_integration_tests"
      on_failure: "notify_failure"
      
    - name: "run_integration_tests"
      type: "execute"
      command: "npm test -- --integration"
      timeout: 1800
      on_success: "generate_report"
      on_failure: "notify_failure"
      
    - name: "generate_report"
      type: "execute"
      command: "npm run coverage"
      timeout: 300
      on_success: "notify_success"
      
    - name: "notify_success"
      type: "message"
      command: "send_notification"
      parameters:
        message: "All tests passed"
        
    - name: "notify_failure"
      type: "message"
      command: "send_notification"
      parameters:
        message: "Tests failed"
        severity: "critical"
        
  constraints:
    max_concurrent_jobs: 3
    timeout: 3600
    rate_limit:
      requests_per_minute: 10
      burst_size: 5
    retry_policy:
      max_attempts: 3
      backoff: "exponential"
      initial_delay: 5
      max_delay: 300
    resource_limits:
      cpu: "2000m"
      memory: "2Gi"
      
  dependencies:
    required:
      - "BuildBot"
    optional:
      - "LintBot"
    conflicts:
      - "LegacyTestBot"
      
  outputs:
    - type: "message"
      destination: "NotificationBot"
      format: "json"
      
    - type: "file"
      destination: "s3://test-results/"
      format: "junit-xml"
      retention: 30
      
    - type: "metric"
      destination: "prometheus"
      format: "openmetrics"
      
  security:
    permissions:
      - resource: "test-database"
        actions: ["read", "write"]
      - resource: "s3://test-results/"
        actions: ["write"]
    encryption:
      enabled: true
      algorithm: "AES-256"
    authentication:
      method: "token"
      
  monitoring:
    health_check:
      enabled: true
      interval: 30
      endpoint: "/health"
    metrics:
      enabled: true
      push_interval: 60
    logging:
      level: "info"
      format: "json"
      
  notifications:
    - event: "test.failed"
      channels: ["slack", "email"]
      severity: "critical"
      template: "Test suite failed: {{test_suite}} - {{error_message}}"
      
    - event: "test.completed"
      channels: ["slack"]
      severity: "info"
      template: "Tests completed: {{passed}}/{{total}} passed"
